17 de Mayo

  Tratando de instalar PHAME con conda pro hay muchos errores.
      conda install phame <--- No sirve
--------------------------------------------------------------------------------------------------------------------------------------------------------
  Instalando de forma alternativa creando un nuevo ambiente y usando el repositorio disponible en github: https://github.com/LANL-Bioinformatics/PhaME

      Create a separate conda environment:

        conda create -n phame_env
        
      Install required dependencies into the environment

        conda install -c bioconda perl-bioperl -n phame_env --yes
        conda install -c bioconda samtools bcftools -n phame_env --yes
        conda install -c bioconda mummer -n phame_env --yes
        conda install -c bioconda bowtie2 -n phame_env --yes
        conda install -c bioconda bwa -n phame_env --yes
        conda install -c bioconda fasttree -n phame_env --yes
        conda install -c bioconda bbmap -n phame_env --yes
        conda install -c bioconda raxml -n phame_env --yes
        conda install -c bioconda perl-parallel-forkmanager -n phame_env --yes
        conda install -c bioconda iqtree -n phame_env --yes
        conda install -c bioconda perl-statistics-distributions -n phame_env --yes
        conda install -c bioconda paml -n phame_env --yes
        conda install -c bioconda mafft -n phame_env --yes
        conda install -c bioconda hyphy -n phame_env --yes ***
        
      ***
          For Linux 64, Open MPI is built with CUDA awareness but this support is disabled by default.
          To enable it, please set the environment variable OMPI_MCA_opal_cuda_support=true before
          launching your MPI processes. Equivalently, you can set the MCA parameter in the command line:
          mpiexec --mca opal_cuda_support 1 ...

          In addition, the UCX support is also built but disabled by default.
          To enable it, first install UCX (conda install -c conda-forge ucx). Then, set the environment
          variables OMPI_MCA_pml="ucx" OMPI_MCA_osc="ucx" before launching your MPI processes.
          Equivalently, you can set the MCA parameters in the command line:
          mpiexec --mca pml ucx --mca osc ucx ...
          Note that you might also need to set UCX_MEMTYPE_CACHE=n for CUDA awareness via UCX.
          Please consult UCX's documentation for detail.

      
      Clone the latest github repo:

        git clone https://github.com/LANL-Bioinformatics/PhaME.git
        
      Then test phame to see if the installation was complete using a short test run:

        source activate phame_env
        cd PhaME
        test/TestAll.sh 1

      El test corre sin errores.
--------------------------------------------------------------------------------------------------------------------------------------------------------
  Instalé orthofinder usando el repositorio: https://github.com/davidemms/OrthoFinder
  
  y todo bien. Revsando el manual.
========================================================================================================================================================
18 de MAYO

    Pruebo correr phame como lo indica el manual: https://github.com/LANL-Bioinformatics/PhaME/tree/master/docs/introduction (runphame.rst)
    pero sale un error:
    readdir() attempted on invalid dirhandle DIR at ./src/phame line 217, <CTL>
      line 1 (#1)
        (W io) The dirhandle you're reading from is either closed or not really
        a dirhandle.  Check your control flow.

    Use of uninitialized value in concatenation (.) or string at ./src/phame line
      218, <CTL> line 1 (#2)
        (W uninitialized) An undefined value was used as if it were already
        defined.  It was interpreted as a "" or a 0, but maybe it was a mistake.
        To suppress this warning assign a defined value to your variables.

        To help you figure out what was undefined, perl will try to tell you
        the name of the variable (if any) that was undefined.  In some cases
        it cannot do this, so it also tells you what operation you used the
        undefined value in.  Note, however, that perl optimizes your program
        and the operation displayed in the warning may not necessarily appear
        literally in your program.  For example, "that $foo" is usually
        optimized into "that " . $foo, and the warning will refer to the
        concatenation (.) operator, even though there is no . in
        your program.

    closedir() attempted on invalid dirhandle DIR at ./src/phame line 220, <CTL>
      line 1 (#3)
        (W io) The dirhandle you tried to close is either closed or not really
        a dirhandle.  Check your control flow.

    readdir() attempted on invalid dirhandle DIR at ./src/phame line 217, <CTL>
      line 2 (#1)
    Use of uninitialized value in concatenation (.) or string at ./src/phame line
      218, <CTL> line 2 (#2)
    closedir() attempted on invalid dirhandle DIR at ./src/phame line 220, <CTL>
      line 2 (#3)
    readdir() attempted on invalid dirhandle DIR at ./src/phame line 217, <CTL>
      line 3 (#1)
    Use of uninitialized value in concatenation (.) or string at ./src/phame line
      218, <CTL> line 3 (#2)
    closedir() attempted on invalid dirhandle DIR at ./src/phame line 220, <CTL>
      line 3 (#3)
    PhaME v1.0.5 
    Uncaught exception from user code:
      No such file or directory at /home/biocomp/software/PhaME/src/../lib/PhaME.pm line 931.
      PhaME::PickRefGenome("/home/biocomp/software/PhaME/workdir", "/home/biocomp/software/PhaME/ref", "/home/biocomp/software/PhaME/workdir/results/ecoli.error", "/home/biocomp/software/PhaME/workdir/results/ecoli.log", "/home/biocomp/software/PhaME/workdir/sketch_output.txt") called at ./src/phame line 294
--------------------------------------------------------------------------------------------------------------------------------------------------------
    revisando el test, el error esta en el archivo .ctl
    
    
20 de mayo

Descargué ete toolkit en con conda en un nuevo ambiente (ete3):

      conda activate ete3
      
tuve un error al iniciar el ambiente: esto lo soluciona

      source ~/anaconda3/etc/profile.d/conda.sh
      conda activate ete3
      
      
23 de MAYO

revise ETE toolkit para hacer y analizar filogenias
dado que orthofinder necesita la lista de proteinas, descargue las secuencias codificantes en .faa 
al fin pude correr orthofinder
El clado que me pasaron contiene dos especies mas:"Calothrix_sp._NIES-2098" y "Calothrix_sp._PCC_7507"
Hice un arbol sin estas especies para ver si el arbol era el mismo.
El arbol fue el mismo.
Hare un arbol extra con las dos especies extra

24 de mayo

Estoy escribiendo un script en perl para obtener la abundancia de HIP
Los arboles pasados solo estan hechos con algunos de los cromosomas de las especies ya que no me fije que no tome en cuenta todo el material genetico
Ahora estoy tratando de hallar la forma de descargar todo el genoma anotado (aa) en formato fasta para volver a hacer los arboles
Tambien estoy buscando la forma de obtener la longitud completa del genoma (con los plasmidos) 

Una idea es quitar los encabezados de cada archivo.fasta y contar el numero de caracteres

26 de MAYO

Quitar los encabezados de cada archivo.fasta y contar el numero de caracteres:

  sed '/^>/d' Calothrix_sp._336_3.fasta >out.without.head.txt

O sumar las longitudfes de los archivos de genebank

Otro detalle es que ahora que tengo los datos de proteinas de cada genoma.
Debo saber si es valido combinarlos para tener un solo archivo por genoma y posteriormente meterlo a orthofinder

30 de MAYO
Codigo de conteo de la longitud del genoma
codigo de conteo de HIP

31 de MAYO
codigo para obtener fastas.

1 de Junio
Revisando como obtener los ortogrupos de 3 genomas que no pude obtener del NCBI
Al revisar el conteo de HIP obtenido previamente me di cuenta que tienen numeros muy grandes.
Revisando la ecuación del conteo.

2 de Junio
Escribiendo un nuevo script del conteo
Me di cuenta que habia otro posible sesgo en el conteo: Los saltos de linea en el archivo fasta.
A cada archivo fasta le quite el encabezado y sustitui cada salto de linea por "nada" para que fuera una sola linea.
El script funciona, pero aun no logro entender el significado de la frecuencia observada:
  No se si se refiere a una frecuencia relativa o al conteo esperado.

3 de junio
Leyendo el paper:
  Determination of Bias in the Relative Abundance of Oligonucleotides in DNA Sequences
  Jeff Elhai
Lei que existia otro sesgo en el conteo: el de oligonucleotidos no contiguos.

  Me puse a contar en un archivo con 3 HIP's traslapados: "GCGATCGCGATCGCGATCGC" usando el buscador del editor de texto y usando grep (grep -o 'GCGATCGC' pal.txt | wc -l)
  Ambas busquedas solo em detectaron 2 HIP's.
Buscare mas al respecto.

4 de Junio
En el articulo:
Determination of Bias in the Relative Abundance of Oli gonucleotides in DNA Sequences
  Jeff Elhai
Hablan de la ecuacion para determinar la fecuencia de un oligonucleotido propuesta por: Karlin et al. [1992]
Sin embargo, esta ecuación se basa unicamente en CONTEOS y no en FRECUENCIAS.
Ademas, ahi mismo se explica que despues de obtener esa frecuencia esperada E_M,
solo basta con  multiplicar por el numero total de nucleotidos (es decir la longitud de la secuencia)
para obtener el numero de oligonucleótidos esperado.

Entonces en el script de conteo use dos enfoques (conteo esperado a base de FRECUENCIAS y CONTEOS) con 4 modelos de markov de 1er a 4to orden cada uno.
Ademas agregue un conteo mas usando N-k+1 en lugarv de N para ver las diferencias.

Al revisar los valores obtenidos era evidente que,
el CONTEO ESPERADO en base a FRECUENCIAS usando N-K+1
el CONTEO ESPERADO en base a FRECUENCIAS usando N y
la FRECUENCIA ESPERADA en base a CONTEOS,
Los valores obtenidos son PRACTICAMENTE LOS MISMOS:
[($f_GC*$f_CG*$f_GA*$f_AT*$f_TC*$f_CG*$f_GC)/($f_C*$f_G*$f_A*$f_T*$f_C*$f_G)]*($long_genoma-8+1)
[($f_GC*$f_CG*$f_GA*$f_AT*$f_TC*$f_CG*$f_GC)/($f_C*$f_G*$f_A*$f_T*$f_C*$f_G)]*$long_genoma = 
 ($c_GC*$c_CG*$c_GA*$c_AT*$c_TC*$c_CG*$c_GC)/($c_C*$c_G*$c_A*$c_T*$c_C*$c_G) .....................................(A)
 
PORQUE?
Si reacomodamos la ecuación dejando un PRODUCTO entre el CONTEO de DINUC y NUC
{ [(1/N-1)^n-1]*(N_w1,w2)*(N_w2,w3)*...*(N_Wn-1,wn) / [(1/N)^(n-2)]*(N_w2)*(N_w3)*...*(N_wn-2)} * (N-n+1)       ......(B)
=>
[ (N_w1,w2)*(N_w2,w3)*...*(N_Wn-1,wn) / (N_w2)*(N_w3)*...*(N_wn-2)]¨* [(1/N-1)^(n-1)]/[(1/N)^(n-2)]*(N-n+1)  ......(C)

n = 8
N = 6283267
(C)
[ (N_w1,w2)*(N_w2,w3)*...*(N_W7,w8) / (N_w2)*(N_w3)*...*(N_w6) ] * [(1/6283266)⁷/(1/6283267)⁶]*6283260 
[ (N_w1,w2)*(N_w2,w3)*...*(N_W7,w8) / (N_w2)*(N_w3)*...*(N_w6) ] * 0.99999999999

Si sacamos el limite cuando N tienede a infinito para un oligo de de n bases:

Limit[[(1/x-1)^(y-1)]/[(1/x)^(y-2)]*(x-y+1),x->inf]

tenemos entonces que:
(1/N-1)^(n-1)]/[(1/N)^(n-2)]*(N-n+1) = 1

Ademas si sacamos el mismo limite cuando usamos N en lugar de n-k+1, tambien tiende a 1
entonces podemos concluir que (A) es cierto.
  
5 de Junio
6 de Junio
7 de Junio
8 de junio
# To activate this environment, use
#
#     $ conda activate dgenies
#
# To deactivate an active environment, use
#
#     $ conda deactivate



